### 1介绍

云储存普遍采用SSD和HDD混合结构来同时获得高IO性能和大容量。**将SSD作为第一层，获得低IO延迟；将HDD作为第二层，获得低成本的大容量存储。SSD作为快速持续写入数据的缓冲区，到来的写请求会迅速保存到SSD中并确认，之后再写入更慢但更大的HDD中。**

**我们通过观察Pangu的储存服务器发现，通常SSD会被过度使用而HDD平均只使用了不到10%**。

写操作对SSD是不友好的，有两个原因：

1. SSD有有限的P/E (Program/Erase)周期，直接关系到写的次数
2. SSD由于垃圾回收机制会有不少的性能下降，即通过将页的有效部分移到新块并回收旧块来回收无效页。**GCs有毫秒级的延迟，会阻塞用户需求，从而导致更高的尾部延迟**。因此目前的研究表示SSD在实际情况中并不总能发挥出其理想性能。

**为了保证写性能必须部署更多更大的SSD。**

对HDD的实验表明，**一系列持续且顺序的小文件写**（4kb）先出现低延迟（35us），然后出现非常高延迟（12ms），然后出现中延迟（55us）。**低和中能提供us级的延迟，因为写请求只要被写入控制器的缓冲区中就被认为是完成了，但如果缓冲区满了，写请求就要等到缓冲区被写入磁盘后才能写入，造成高延迟。**

**目标**：完全利用HDD缓冲区的写性能，提升性能并分担SSD的写压力，在不添加额外硬件的情况下实现高性能和高可靠性。

**挑战**：如何精准预测写请求到来的时机？我们设计了一个**预测模型**来预测下一次HDD的写状态，关键在于持续和顺序的HDD写请求是周期性的。可以通过缓冲区写的时期和当前写状态来预测下一次的写状态。然后提出了 **Buffer-Controlled Write (BCW)** ，能根据预测器和IO监控来主动和有效地控制缓冲区写行为。而且BCW会通过在HDD慢写时填充数据来跳过满写。

进一步提出混合**IO调度器**（MIOS），通过写模式，运行时队列长度和磁盘状态来自适应地将写请求重定向到SSD或HDD。

### 6相关工作

**IO调度器**

HDD的IO调度器已有大量研究： CFQ, Anticipatory, Deadline, NCQ。随着SSD普及，更多最近的研究着手解决闪存IO的问题，如读写性能不对成和内部并行性。

- FIOS利用公平IO时间片管理机制来实现SSD的公平性和高效率
- HIOS在主机端给出GC感知和QoS感知的调度器
- PIQ和ParDispatcher 最小化了IO请求之间的冲突。

大量研究进一步提供SSD内部的调度策略来减少IO流之间的干扰，写放大和GC负载

- SWAN将SSD分为多个区域来各自处理写请求和执行GC

**混合储存**

大多数研究将SSD作为一个读cache和写缓冲，HDD作为第二储存器。之前的工作页将HDD作为SSD的写缓冲来减少后者的数据写入。此外，也有研究将SSD-HDD作为混合RAID来扬长补短。

- NVMM和磁盘上的分层文件系统Ziggurat能处理磁盘更大的异步写操作
- SWR仅仅用高层队列将同步大写重定向到HDD。
- BCW进一步利用HDD缓冲区来重定向同步小写且避免了性能损失。