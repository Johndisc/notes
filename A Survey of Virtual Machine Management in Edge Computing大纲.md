# A Survey of Virtual Machine Management in Edge Computing

# 1.介绍

目前云计算很重要，公司和个人都可以通过云计算来进行批量或耗资源的计算任务。然而在为网络边缘用户提供服务时会造成很大的延迟，这对于某些场景来说是不可接受的。因此，边缘计算作为云计算的延伸被提出，用来解决上述问题。

边缘计算的硬件设备能力有限，面对着硬件资源管理的问题。因此，边缘计算的基础是虚拟化技术（主要有虚拟机和容器），提供以下几种特点：

1. 平台独立，可以处理不同的硬件设施
2. 抽象化资源，简化应用开发
3. 硬件级隔离
   - 虚拟机：硬件级隔离，错误互不影响
   - 容器：OS级隔离，一个容器的错误可能会影响整个主机，但优点是轻量，且OS级隔离一般足够

边缘计算的特点和挑战：

1. 稀疏分布

   > 相较于云计算环境来说，一个地区的边缘计算的节点更稀疏，在节点之间迁移虚拟机和容器时更加费时。**需要提供无缝服务**

2. 资源有限

   >  硬件资源有限。**需要合理安排虚拟机/容器**

3. 有限的服务范围

   > 由于边缘节点的服务范围有限和终端设备的流动性，虚拟机/容器可能需要在节点之间频繁地迁移。**需要提高迁移效率**

4. 终端设备的流动性

   > 同上

5. 可靠性低

   > 边缘节点错误率更高。**需要在出错时更有效地转移虚拟机/容器**

6. 容易受到攻击

   > 很多边缘节点是由第三方部署的，技术力比云计算大公司更弱。**需要实现安全计算**

# 2.虚拟化框架

## A. 挑战

1. VM占用大量资源

   > 边缘节点的硬件不强，且VM消耗大量资源，因此同时支持的VM有限。
   >
   > 解决方案：**轻量化虚拟技术（LXC、Docker），或能够减少VM资源消耗的计数（unikernels）**

2. VM数据量庞大

   >边缘计算框架需要支持频繁的VM转移，包括VM在内存和磁盘中的大量数据
   >
   >解决方案：**同上，以及减少数据传输大小的技术（重复数据删除和合并）**

3. 安全问题

   > 边缘计算框架在VM管理上需要保证用户隐私安全。
   >
   > 解决方案：**问责制、计算审计、SGX、同态加密**

## B. 工业软件架构

1. OpenStack

2. KudeEdge

   > Kubernetes谷歌设计的一个容器编排系统，原本用于自动部署和管理使用容器的大型云计算应用。华为在其基础上设计了KudeEdge，能够实现云端和边缘的快速交流。边缘计算应用能够直接用Kubernetes的API实现，并能与远程的数据中心协同工作。

3. OpenEdge

   > 百度的开源项目，旨在将云计算无缝延伸到边缘设备的边缘计算。该平台在边缘设备上包括两个部分：主控制器和一系列可装载的插件模块。两种工作模式：Docker容器模式和本地进程模式

## C. 研究项目

1. Paradrop

   > 旨在在WIFI AP上搭建边缘计算环境，包含3个部分：1.计算部分 2.管理部分 3.开发者API

2. AirBox

   > EF（edge function）平台，实现两个特点：
   >
   > - 快速且大量的提供EF（通过docker打包实现）
   > - 保证EF的完整性（通过SGX实现，能够以低成本保证计算的完整性）

3. Middleware for IoT Clouds

   > IoT云的供应方案，依靠于SDG。SDG是一个软件定义的、轻量的VM，将边缘资源虚拟化，来让IoT云为边缘设备提供隔离的运行环境。其中，供应代理与外部的控制平面交流，来处理用户请求并加载函数库；监控器和以上二者合作管理SDG的生命周期。

4. FocusStack

   > 主要解决云-边缘的控制平面建立问题。由于云-边缘系统的庞大和边缘节点的可流动性，为云计算设计的控制平面建立方案不再适用。
   >
   > FocusStack把终端设备也看做边缘节点，当一个终端设备提出计算请求时，该设备先联系本地的指挥者，指挥者联系OpenStack服务器，来决定把计算任务分配给谁，指挥者再把计算任务打包到docker中，发给目标设备进行计算。

5. Amino

   > 解决问题：开发者在开发云-边缘程序时需要考虑程序在整个系统上的并发性，一致性和复制，比较困难。
   >
   > 采用Sapphire作为底层，模块化设计，采用实现了分布式机制的系统库来让分布式应用能够简单的被定制和编排。

6. Lightweight Service Replication for Mobile-Edge Computing

   > 为了解决移动边缘计算中的硬件限制问题和用户流动性问题，作者的设计思路为：
   >
   > - 用docker封装计算，比VM代价更低
   > - 提出基于实时迁移和检查点的轻量级服务方式。当终端用户在进行迁移同时执行docker计算时，通过主动迁移docker容器，来降低用户移动时导致的性能下降

7. SOUL

   > 目的是让移动设备能够共享传感器。该框架将设备的传感器进行虚拟化，供给那些没有特定传感器的设备进行使用，使它们支持一些需要该传感器的应用程序。底层上是通过重定向两台设备上传感器的输入和输出来实现的。

8. LAVEA

   > 用于实时视频分析的边缘计算平台。将视频流分割成小的计算单元，终端设备适当地将部分计算单元分配给边缘节点并自己计算剩余部分

9. Cloudlet-Based Frameworks

   > 两种基于cloudlet的计算框架：
   >
   > - 通过将从终端设备接收到的overlay应用到基础VM上来复原一个VM实例，特点是适时地利用企业环境中的配置工具来自动化虚拟机搭建，以此改善了VM综合的表现，且更加灵活
   > - OpenStack++，基于OpenStack的cloudlet部署系统。利用OpenStack的机制扩展实现cloudlet上的VM综合方案，能够在从终端设备收到VM overlay时自动搭建虚拟机并且在OpenStack平台上启动

10. IoT Camera Virtualization

    > 通过IoT摄像头实现的视频分析边缘平台。两个特点：
    >
    > - 边缘设备将IOT摄像机虚拟化来同时支持多个边缘应用
    > - 边缘设备能迅速重新配置IOT摄像机来适应环境改变（亮度下降），从而保证视频分析的服务质量

# 3.虚拟化技术

虚拟化技术是云计算和边缘计算的基础，但传统的云计算虚拟技术并不完全满足边缘计算领域的要求。目前改进的虚拟化技术有系统虚拟化、内核虚拟化、地域虚拟化和网络虚拟化。

## A.虚拟机——系统虚拟化

游牧服务：移动设备将任务通过cloudlet客户端发给cloudlet服务器，再分发给各个VM（一跳）执行，以此减少移动设备的负担。

两种虚拟技术能将VM状态发送给cloudlet设施：VM迁移和VM综合。动态VM综合由于其较快的综合速度更受青睐。

VM综合将虚拟机镜像分成两层：基础VM镜像和VM overlay层。基础层包括OS内核和函数库，overlay层储存在终端设备上。当需要分配任务时，终端用户将VM overlay移交给附近的已经部署了基础镜像的cloudlet，且基础镜像已经准备好，就能很快搭建好虚拟机开始执行。

VM综合包含3个耗时的步骤：

- overlay传递延时 
- 解压延时 
- 部署延时

加速方法：

- 减小overlay大小 
- 修改综合管道来加速VM镜像的启动

除了VM外，unikernel也是一种适合边缘计算的虚拟化技术。unikernel相较于VM有更低的内存占用、更小的大小和高级语言编写的更加内存安全的VMs。

## B.Linux Containers——内核虚拟化

LXC是一种系统级虚拟化技术，所有容器共享同一个OS内核，底层系统只需要保留一份内核，节省空间。每个容器都能提供与VM尽可能相似的环境。

目前将容器技术应用于边缘环境是一种趋势，因为虚拟化实例需要迅速的构造、实例化和初始化，并且能够以更小的虚拟镜像实现高强度的应用服务，从而允许更多实例的部署。一个容器的生命周期有4个功能指标：服务的部署和终止、资源和服务的管理、容错度和捕获能力。

## C.服务的可流动性——地域虚拟化

由于用户的流动性，边缘服务在网络断开时质量会下降，为了保证持续的高服务质量，服务需要在用户移动时迁移到新的服务器上。实时迁移技术主要有基于VM的迁移、基于容器的迁移和基于进程的迁移。

1. 基于VM的迁移

   > 一种是基于VM综合技术的VM传递；一种是通过伪增量将VM镜像分为两到三层，然后通过rsync增量文件实现同步；一种是使用多路径TCP并行迁移VM镜像；一种是建立雾结构来支持VM迁移。

2. 基于容器的迁移

   > 一种是基于检查点/恢复技术和rsync命令的容器迁移技术；一种是在边缘节点之间共享存储层，逐渐迁移运行内存来减少实时迁移时间，可以较少56%以上。

3. 基于进程的迁移

   > 基于进程的迁移在大数据中心的分布式系统中十分重要，目前的进程迁移实例设想一个共享或分布式的网络存储，所有的迁移目标都有相同的底层系统视角。但这对于边缘计算环境并不适用，目前边缘环境中高效的存储共享是主要的障碍。

## D.基于VM的SDN——网络虚拟化

一些边缘计算应用需要高带宽、低延迟和动态网络配置，目前SDN可以满足，具有动态、可管理、高效和适应性强的特点。

VM虚拟技术在SDN结构中很重要。NetVM虚拟化网卡，驱动网卡转发定制化管理程序的数据包，并使每个VM共享网络资源，由此减少在系统的不同层次拷贝数据包的成本。

SDN的一个缺点是无法在不支持的老设备上部署。

## E.边缘计算的虚拟化挑战

高效的服务迁移尚待研究，网络虚拟化需要解决老设备的兼容性问题和大范围的分布式部署问题，虚拟化技术需要在相对更低的硬件需求下实现高效低能耗，在大范围使用时带宽使用更加高效

# 4.部署和调度

本节介绍一些VM部署和调度的优化问题。

## A.优化安装成本

服务提供商的首要问题是将边缘节点安装到合适的地点，安装节点成本主要包括场地租金和特定地区的计算需求。大部分的节点部署优化问题可以被建模成一个混合整数非线性规划问题，即成本=每个节点的部署成本+约束函数（参数为每个任务的时间和几率）。

## B.优化响应时间

一种主流的研究思路是优化访问时间和响应时间，但并不好进行，问题在于：

- 设备移动无法预测
- 长期来看数量太多无法预测
- 任务负载动态变化，不能简单按照执行时间安排

一种边缘计算的结构是将应用组件级管理，应用组件可以被独立地分布到VM，使其能够并行处理。

近年来，cloudlet被认为是对于大城市地区（WMAN）的无线网络的最佳技术，因为其多且密集的计算需求，且这项技术的成本较低。一种优化问题是对于WMAN中一定的边缘节点，找到最佳的VM部署策略和用户到cloudlet的分配策略。传统方案中VM控制者总是把任务分配给最近的VM，造成了任务的分配不均和资源争夺。有学者注意到这个问题遵循木桶原则，即系统的表现取决于最长的任务响应时间，他们也给出了该问题的一个建模。

## C.优化能耗

VM部署的能耗主要包含：

- CPU或GPU在执行每个任务时的内部能耗
- 执行中的VM数
- 空闲的服务器
- VM合并的传输距离和频率

有学者将能耗问题建模成ILP问题和PSO问题，并总结出两点：

- CPU使用率和能耗成线性关系
- 空闲服务器消耗了超过60%的能源

除此之外，也有很多学者提出了不同的优化方法。

## D.优化服务提供商收入

对于服务提供商来说，权限控制模型是非常重要的，一种模型是采用SMDP来最大化利润，通过分配给用户不同优先级的资源来保证服务质量。最大化收入的另一种方案是通过拍卖策略，用户按需为资源竞价。

## E.优化其他

一种是最大化系统级的通量，通过任务的优先级门槛来决定是否接受；一种是分析VM迁移过程并建立代价和收益的关系模型来优化迁移收益；一种是通过多维度随机配置来较少所需要的服务器数。

# 5.边缘计算的无服务器管理

无服务器（FaaS）是建立在虚拟环境服务上的抽象层，能够提供能在任何时间和地点运行的应用程序的抽象集合，应用到云服务和本地服务，以及边缘计算平台。无服务框架建立在虚拟技术上，因此无服务管理本质上是虚拟实例管理。下面主要讨论这一点。

1. 生命周期管理

   > FaaS的工作负载类型是事件驱动，由事件触发无服务实例的工作、报告和终止回收。由于同时到来的事件可能很多，因此需要限制每个实例的计算资源和内存。

2. 成本导向管理

   > 无服务的成本主要在于函数的执行时间和内存需求，两个主要的优化问题类别是函数合并和函数布置。函数合并能够大幅降低过渡成本并使函数布置更加灵活。

接下来介绍一些无服务器管理的挑战：

1. 函数部署。由于资源限制。
2. 函数调用。冷启动：实例化一个包含该函数的VM/容器。冷启动节约资源但耗时。热启动：在函数调用之前很多VM/容器会处于准备状态。热启动耗资源，边缘节点难以准备各种运行环境的VM/容器，但优势在于可以与附近的边缘节点或云节点合作。
3. 函数链。函数链包含了复杂应用中的函数关系，在无服务环境下的需求越来越多。
4. 函数的合并与分解。由于边缘和云的资源不平衡。

# 6.虚拟化和安全

由于边缘节点储存用户的敏感数据，因此安全性也很重要。

## A.出于安全因素使用虚拟化技术

为了保护隐私，边缘节点需要隔离每个服务的数据和资源。由于VM固有的隔离性，因此虚拟化技术在这安全方面是最直接的方式。边缘计算中3中隔离方式：

1. 用户数据隔离：虚拟机之间不能直接访问数据，因此直接用虚拟机进行隔离
2. OS隔离：当某一个服务环境崩溃时不会影响到其他服务环境
3. 资源隔离

## B.边缘VM中的安全问题

1. 边缘节点的安全

   > - 物理上不安全，容易被入侵
   > - 在边缘节点创造加的边缘服务进行侧道攻击

2. 网络安全

   > - 在VM迁移时进行干扰
   > - 在迁移时造成信息泄露
   > - 部署一个假节点引诱其他节点迁移
   > - 初始化VM需要大量资源，而边缘节点资源有限，因此可以进行DoS攻击（耗尽资源）

## C.对策

1. 身份认证管理

   > - 从第三方拿到凭证，建立连接时首先检查凭证
   > - 传统加密模式：IBE（用户通过自己的身份生成公钥） ABE（用户通过自己的属性计算公钥）

2. 入侵检测系统

   > 在边缘节点部署IDS，监测网络中的攻击和异常活动

3. 信任管理

   > 用户在使用服务前需要先保证边缘节点可信任，不仅是身份安全，还要能保证服务的正常运行。

4. 容错系统

   > 边缘节点需要有较高的容错度，能够迅速从错误中恢复，最基本的策略是把任务分流给周边的节点。

